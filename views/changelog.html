<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Changelog - MAYA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Outfit', system-ui, sans-serif;
            background: #0e0e10;
            color: #e0e0e0;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        #navbar {
            background: #1a1a1a;
            padding: 10px 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 1000;
            height: 50px;
        }
        #navbar img { height: 30px; width: auto; }
        #navbar a { text-decoration: none; color: #fff; font-size: 14px; font-weight: 500; }
        .navbar-spacer { height: 50px; }

        .changelog-container {
            max-width: 740px;
            margin: 50px auto 80px;
            padding: 0 24px;
        }

        .changelog-header {
            margin-bottom: 48px;
        }
        .changelog-header h1 {
            font-size: 32px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
        }
        .changelog-header p {
            font-size: 16px;
            color: #868585;
        }

        .changelog-entry {
            position: relative;
            padding-left: 32px;
            margin-bottom: 48px;
        }
        .changelog-entry::before {
            content: '';
            position: absolute;
            left: 0;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc2626;
        }
        .changelog-entry::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 24px;
            width: 2px;
            bottom: -36px;
            background: #2c2c2c;
        }
        .changelog-entry:last-child::after { display: none; }

        .changelog-date {
            font-size: 13px;
            font-weight: 600;
            color: #dc2626;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .changelog-title {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 10px;
        }
        .changelog-body {
            font-size: 15px;
            line-height: 1.7;
            color: #b0b0b0;
        }
        .changelog-body h3 {
            font-size: 16px;
            font-weight: 600;
            color: #dc2626;
            margin-top: 16px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .changelog-body h3:first-child { margin-top: 0; }
        .changelog-body ul {
            padding-left: 20px;
            margin: 8px 0;
        }
        .changelog-body li {
            margin-bottom: 6px;
            line-height: 1.6;
        }
        .changelog-body p {
            margin-bottom: 8px;
        }
        .changelog-body strong {
            color: #e0e0e0;
            font-weight: 600;
        }
        .changelog-body code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            color: #dc2626;
        }
        .changelog-body a {
            color: #3b82f6;
            text-decoration: none;
        }
        .changelog-body a:hover {
            text-decoration: underline;
        }

        .changelog-tag {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 6px;
            margin-bottom: 8px;
        }
        .tag-feature { background: #22c55e22; color: #22c55e; }
        .tag-fix { background: #f59e0b22; color: #f59e0b; }
        .tag-update { background: #3b82f622; color: #3b82f6; }
        .tag-breaking { background: #ef444422; color: #ef4444; }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #868585;
        }
        .empty-state h2 {
            font-size: 22px;
            color: #555;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="navbar">
        <a href="/" style="display: block;">
            <img src="/images/maya-logo.png" alt="MAYA" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\'color:#dc2626;font-size:24px;font-weight:700;\'>MAYA</span>'">
        </a>
        <a href="/">Back to Store</a>
    </div>
    <div class="navbar-spacer"></div>

    <div class="changelog-container">
        <div class="changelog-header">
            <h1 id="changelog-title">Changelog</h1>
            <p id="changelog-subtitle">Latest updates and improvements</p>
        </div>
        <div id="changelog-entries">
            <div class="empty-state">
                <div style="font-size: 40px; margin-bottom: 16px;">&#128220;</div>
                <h2>No entries yet</h2>
                <p>Check back soon for updates.</p>
            </div>
        </div>
    </div>

    <script>
        const slug = window.location.pathname.replace('/changelog/', '');

        const titles = {
            'Pledgemanager': { title: 'Pledge Manager Changelog', subtitle: 'Updates to the MAYA Kickstarter Pledge Manager' },
            'ebook/MAYA-book-one': { title: 'MAYA: Seed Takes Root - eBook Changelog', subtitle: 'Updates to MAYA Book One digital edition' }
        };

        const meta = titles[slug] || { title: 'Changelog', subtitle: '' };
        document.getElementById('changelog-title').textContent = meta.title;
        document.getElementById('changelog-subtitle').textContent = meta.subtitle;
        document.getElementById('page-title').textContent = meta.title + ' - MAYA';

        const tagClasses = { feature: 'tag-feature', fix: 'tag-fix', update: 'tag-update', breaking: 'tag-breaking' };

        fetch('/api/changelog/' + slug)
            .then(r => r.json())
            .then(entries => {
                if (!entries.length) return;
                const container = document.getElementById('changelog-entries');
                container.innerHTML = entries.map(e => {
                    const tags = (e.tags || '').split(',').filter(Boolean).map(t =>
                        `<span class="changelog-tag ${tagClasses[t.trim()] || 'tag-update'}">${t.trim()}</span>`
                    ).join('');
                    const date = new Date(e.published_at || e.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    return `<div class="changelog-entry">
                        <div class="changelog-date">${date}</div>
                        ${tags}
                        <div class="changelog-title">${e.title}</div>
                        <div class="changelog-body">${e.body}</div>
                    </div>`;
                }).join('');
            })
            .catch(() => {});
    </script>
</body>
</html>
