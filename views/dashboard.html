<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dashboard - MAYA Pledge Manager</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div>
                <h1>MAYA Pledge Manager</h1>
                <p>Manage your Kickstarter pledge</p>
            </div>
            <div class="user-info">
                <span id="user-email"></span> | <a href="/logout" style="color: white;">Logout</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-step active">
                <div class="progress-circle">1</div>
                <div class="progress-label">Your Order</div>
            </div>
            <div class="progress-step clickable" onclick="window.location.href='/addons'">
                <div class="progress-circle">2</div>
                <div class="progress-label">Add-ons</div>
            </div>
            <div class="progress-step clickable" onclick="window.location.href='/shipping'">
                <div class="progress-circle">3</div>
                <div class="progress-label">Shipping</div>
            </div>
            <div class="progress-step clickable" onclick="window.location.href='/checkout'">
                <div class="progress-circle">4</div>
                <div class="progress-label">Payment</div>
            </div>
        </div>

        <!-- Welcome Message -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Welcome back!</h2>
                <p class="card-subtitle">Backer #<span id="backer-number"></span></p>
            </div>
        </div>

        <!-- Kickstarter Pledge -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Your Kickstarter Pledge</h3>
                <p class="card-subtitle">âœ“ Paid on Kickstarter</p>
            </div>

            <div class="form-grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <strong>Pledge Tier:</strong>
                    <p style="color: var(--primary-red); font-size: 20px; font-weight: 600;" id="reward-title">-</p>
                </div>
                <div>
                    <strong>Amount Paid:</strong>
                    <p style="color: var(--primary-red); font-size: 20px; font-weight: 600;" id="pledge-amount">$0.00</p>
                </div>
            </div>

            <h4 style="margin-bottom: 15px; color: var(--text-dark);">Items Included in Your Pledge:</h4>
            <ul class="item-list" id="kickstarter-items">
                <!-- Items will be loaded here -->
            </ul>
        </div>

        <!-- Kickstarter Add-ons (if any) -->
        <div class="card" id="kickstarter-addons-card" style="display: none;">
            <div class="card-header">
                <h3 class="card-title">Add-ons Purchased on Kickstarter</h3>
                <p class="card-subtitle">These are already included in your order</p>
            </div>

            <ul class="item-list" id="kickstarter-addons-list">
                <!-- Add-ons will be loaded here -->
            </ul>
        </div>

        <!-- Next Steps -->
        <div class="card" style="text-align: center; padding: 40px;">
            <h3 style="margin-bottom: 15px;">Ready to add more items?</h3>
            <p style="color: var(--text-muted); margin-bottom: 25px;">
                Browse our exclusive add-ons and enhance your MAYA collection!
            </p>
            <a href="/addons" class="btn btn-primary btn-large">
                ðŸ›’ Browse Add-ons
            </a>
        </div>
    </div>

    <script>
        // Load user data
        async function loadUserData() {
            try {
                const response = await fetch('/api/user/data');
                const userData = await response.json();

                // Display user info
                document.getElementById('user-email').textContent = userData.email;
                document.getElementById('backer-number').textContent = userData.backerNumber || '-';
                document.getElementById('reward-title').textContent = userData.rewardTitle || 'No reward tier';
                document.getElementById('pledge-amount').textContent = '$' + (userData.pledgeAmount || 0);

                // Display Kickstarter items
                const itemsList = document.getElementById('kickstarter-items');
                const items = userData.kickstarterItems || {};
                
                const itemNames = {
                    ebook: 'MAYA: Seed Takes Root ebook (Edition Zero)',
                    paperback: 'MAYA: Seed Takes Root Paperback (Edition Zero)',
                    audiobook: 'MAYA: Seed Takes Root Audiobook (Narrated by Hugo Weaving)',
                    hardcover: 'MAYA: Seed Takes Root Hardcover (Edition Zero)',
                    book2_hardcover: 'MAYA: Whispers In The Soil | Book 2 Hardcover',
                    book3_hardcover: 'MAYA: It Becomes The Forest | Book 3 Hardcover',
                    lorebook: 'MAYA Lore: Its Species And Their Cultures (Edition Zero)',
                    built_env: 'Built Environments of MAYA Hardcover (Phase 1 & 2)',
                    pendant: 'Flitt Locust Pendant',
                    art_book: 'Limited Edition MAYA Art Book'
                };

                let hasItems = false;
                for (const [key, name] of Object.entries(itemNames)) {
                    const quantity = items[key] || 0;
                    if (quantity > 0) {
                        hasItems = true;
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span class="item-name">ðŸ“– ${name}</span>
                            <span class="item-quantity">Qty: ${quantity}</span>
                        `;
                        itemsList.appendChild(li);
                    }
                }

                if (!hasItems) {
                    itemsList.innerHTML = '<li><span class="item-name" style="color: var(--text-muted);">No items in this pledge tier</span></li>';
                }

                // Display Kickstarter add-ons (if any)
                const addons = userData.kickstarterAddons || {};
                const addonsList = document.getElementById('kickstarter-addons-list');
                const addonsCard = document.getElementById('kickstarter-addons-card');
                
                const addonNames = {
                    pendant: 'Flitt Locust Pendant',
                    audiobook_addon: 'MAYA: Seed Takes Root Audiobook',
                    built_env_addon: 'Built Environments of MAYA Hardcover',
                    lorebook_addon: 'MAYA Lorebook'
                };

                let hasAddons = false;
                for (const [key, name] of Object.entries(addonNames)) {
                    const quantity = addons[key] || 0;
                    if (quantity > 0) {
                        hasAddons = true;
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span class="item-name">âœ“ ${name}</span>
                            <span class="item-quantity">Qty: ${quantity}</span>
                        `;
                        addonsList.appendChild(li);
                    }
                }

                if (hasAddons) {
                    addonsCard.style.display = 'block';
                }

            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        loadUserData();
    </script>
</body>
</html>

